{"componentChunkName":"component---src-templates-blog-post-js","path":"/JWT/jwt/","result":{"data":{"site":{"siteMetadata":{"title":"춘이코드","author":"chunnycode","siteUrl":"https://chunnycode.github.io","comment":{"disqusShortName":"","utterances":"chunnycode/chunnycode.github.io"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"bc87d78d-d223-5f02-8f03-6040fb1987a9","excerpt":"JWT : JSON Web Token RFC 7519 Specialized website about JWT with tools and documentation : JWT Web Decoder JWT는 JSON 객체를 통해 안전하게 정보를 전송할 수 있는 웹 표준 RFC7519 이다. 간단하게 말해 JSON을 사용한 TOKEN 인증 방식을 말한다.  xxxx.yyyy.zzzz 구조는 위와 같으며 ’.’ 으로 각각 구분된 문자열로 이루어져 있다.  각각의 파트는  Header Payload…","html":"<h2 id=\"jwt--json-web-token\" style=\"position:relative;\"><a href=\"#jwt--json-web-token\" aria-label=\"jwt  json web token permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT : JSON Web Token</h2>\n<ul>\n<li><a href=\"https://datatracker.ietf.org/doc/html/rfc7519\">RFC 7519</a></li>\n<li>Specialized website about JWT with tools and documentation : <a href=\"https://jwt.io/\">JWT Web Decoder</a></li>\n</ul>\n<p>JWT는 JSON 객체를 통해 안전하게 정보를 전송할 수 있는 웹 표준 RFC7519 이다.<br>\n간단하게 말해 JSON을 사용한 TOKEN 인증 방식을 말한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAz0lEQVQY002QUW/CMAyE8///HqIMssLYwzRCQYi2KGls3y5NkPbw+epzenLizAwGmIkCMZEIpFRZUvVS89+kCJMMlD/JmtFway32HCHHK3IXIKcbpB+QDzdC9QPEF5/zj4C8DVjOT+QZyKO9I9Z81+JMH1yoA7QnZx7cs99QD8Q3dpz98PhI7iSQoQZZ29TVGwOPyeAvii4IdheBvyr6oPgix0FxIvtfweeY8Z3oR/pFibYNS3XruiwLdSJPoWqD/cvq99z6ifM5V6am/9/wD8OyhQ9ViVLWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"encoded jwt3\"\n        title=\"encoded jwt3\"\n        src=\"/static/ef11eceff9216e3d4b3c4cd24db63f35/c1b63/encoded-jwt3.png\"\n        srcset=\"/static/ef11eceff9216e3d4b3c4cd24db63f35/5a46d/encoded-jwt3.png 300w,\n/static/ef11eceff9216e3d4b3c4cd24db63f35/0a47e/encoded-jwt3.png 600w,\n/static/ef11eceff9216e3d4b3c4cd24db63f35/c1b63/encoded-jwt3.png 1200w,\n/static/ef11eceff9216e3d4b3c4cd24db63f35/d1882/encoded-jwt3.png 1562w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"xxxxyyyyzzzz\" style=\"position:relative;\"><a href=\"#xxxxyyyyzzzz\" aria-label=\"xxxxyyyyzzzz permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>xxxx.yyyy.zzzz</h2>\n<p>구조는 위와 같으며 ’.’ 으로 각각 구분된 문자열로 이루어져 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 959px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAADsUlEQVQ4y6WUzWskRRjGo15DckgyGchRyK5xVxxjPobAbpQFQ1bw4DIQ8R/w5MF4CiiKsDnsUd1MzLroRfAgeBeEMCHqbpLO5mM+8jEyyawmmfT0TPf0dLqr6vGt6p7OZJ1dBAse6uutX731VHW3/ZlefzOd1d5bXdUSuWw2sbW1lcjlcol0Op3IUv9ZymQyid3dnUQmnZ16+NtKtE2WzQepjd38JlbX1vG4WISu67BtG+VyGaZptpRlWWFdOtGxX9jDjz//kFDAazdurk3ceBsTE295Y2NjfHBwkMfjcT4+Ps5HR0dVe2RkJGzH46N8aGiIDw8Pq9hr1697kzcn8fLVgSkFvPRibO3yldcxMHCZRSK9or29XfREIqK/v1/0Uh2NRkV3d7fo6uoSEer39PSIjo4O0dnZqWL7+vp4LBZDtDfqA0ulYw1UPM9jVMA5h6xd14VhGNBPddTIApqXYWq+IUGFxrmAwOLiog88OjrSqA+zWmWybi6C+wOO4yjPKpWKAjWHyD1kY3l52Qfm83nNoMDDYpF5ctcgoiFZZKaFQgEHhQMFb2Qq/KLClpaWfGDFMNSRYdkMVROiXIEwApUNCNdTFtTrTphSwxqS4EHKqVTKB54en2jI6nC1AnNyJuz1OurbNuqPSCs2uEWLBblhn1HbhqjWgsMKlWHjICFQL+kadPJpH8zep0T3SFmgWgTZANh1Ic0Eag5lbUFUaufuNXkYAkununboAo9OPJY5Zdg3GA5JRXJgr85gMQFGNy4fsfSYX7zpFkfWdU26c+xwVmONbUWYhTyVRz7Ky6Dlak6IUOGlnB+ZgMFq5lsj/IOIAE61BDETcA2y5m+q9fDRtPAwAHIhmGiCiCeBFhRUinv/ASiagE9C3TMXds1EjeQx19/gaR4+Exg8D5c+O91ylPz1Inw2T/WwAbygBpggBYsjV2H4q8ZQMBmMM5mlSuHfz0b9HOj1EhEXpcbV8YqWh7zp4TE9pwJBdQLKvwLFXAQ6FX3t/JaFaC0eqNVc8HNYCoD3Mier03lgOlP3PsrUuRS1+UzO4V/sOfzzXYd/uuPwz6i+ve/wT6j9cRAj9WG67t05EPjp1wA4vXK0fWUDiP1xhlcfMqXXSOMaw1Ra4N0tjnc2OSY3OG5tc7xB46888MK4l353cWsH+P6X1PsKOD8398H9hW/uLMwnb9+bT842lEwmZ7+cS85+RfqadHfO78vx5rgF6n93/9vZmZmZq21BeY70wv/U8xJEVrb9A4DNoECq/l0lAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"legacy app auth 5\"\n        title=\"legacy app auth 5\"\n        src=\"/static/59d8f25cf0111c6996df9e630c5b5253/d7abb/legacy-app-auth-5.png\"\n        srcset=\"/static/59d8f25cf0111c6996df9e630c5b5253/5a46d/legacy-app-auth-5.png 300w,\n/static/59d8f25cf0111c6996df9e630c5b5253/0a47e/legacy-app-auth-5.png 600w,\n/static/59d8f25cf0111c6996df9e630c5b5253/d7abb/legacy-app-auth-5.png 959w\"\n        sizes=\"(max-width: 959px) 100vw, 959px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>각각의 파트는 </p>\n<ul>\n<li>Header</li>\n<li>Payload</li>\n<li>Signature </li>\n</ul>\n<p>세 부분으로 이루어져있다.<br>\n헤더는 토큰 타입과 해싱 알고리즘을 저장하고, 페이로드는 실제 전달할 정보를, 서명에는 위변조 방지를 위한 값이 들어간다. </p>\n<ol>\n<li>Header<br>\n헤더는 typ와 alg 두가지 정보로 구성된다.\ntyp는 토큰의 타입을 지정한다.<br>\nalg는 Signature를 해싱하기위한 알고리즘을 지정한다. </li>\n<li>\n<p>Payload<br>\n토큰에서 사용할 정보들의 조각인 Claim이 담겨있다.\n클레임은 Registered Claim, Public Claim, Private Claim 세가지로 나누어진다.\nJSON 형태로 정보들을 담는다.</p>\n<ul>\n<li>등록된 클레임<br>\n이미 정해진 종류의 데이터들로 선택적 작성이 가능하나 사용이 권장된다.<br>\n간결성을 위해 key의 길이는 모두 3이다. </li>\n<li>iss : 토큰 발급자 issuer</li>\n<li>sub : 토큰 제목 subject</li>\n<li>aud : 토큰 대상자 audience</li>\n<li>exp : 토큰 만료 시간 expiration (ex 1123451351351)</li>\n<li>nbf : 토큰 활성 날짜 not before (활성날짜 이후부터 활성화됨)</li>\n<li>iat : 토큰 발급 시간 issued at (토큰발급 이후의 경과시간) </li>\n<li>jti : JWT 토큰 식별자</li>\n<li>\n<p>공개 클레임</p>\n<ul>\n<li>\n<p>사용자 정의 클레임으로 공개용 정보를 위해 사용되고 uri 포맷을 사용해 충돌을 방지한다 </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{ \n\"https://chunnycode.github.io\" : true\n}</code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>비공개 클레임</p>\n<ul>\n<li>\n<p>사용자 정의 클레임으로 서버와 클라이언트 사이에 임의의 정보를 저장한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{ \n\"userId\" : user1\n\"userName\" : chunnycode\n}</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Signature<br>\n고유의 암호화 코드로 토큰을 인코딩하거나 유효성 검증을 할 때 사용한다.<br>\n헤더와 페이로드의 값을 각각 base64url로 인코딩후, 그 값을 비밀 키를 이용해 헤더에서 정의한 알고리즘으로 해싱하고<br>\n이 값을 다시 base64url로 인코딩하여 생성한다. </li>\n</ol>\n<h2 id=\"jwt-로그인-vs-세션-로그인\" style=\"position:relative;\"><a href=\"#jwt-%EB%A1%9C%EA%B7%B8%EC%9D%B8-vs-%EC%84%B8%EC%85%98-%EB%A1%9C%EA%B7%B8%EC%9D%B8\" aria-label=\"jwt 로그인 vs 세션 로그인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT 로그인 vs 세션 로그인</h2>\n<p>보통 로그인을 구현할 때 세션을 사용한다.<br>\n클라이언트에서 서버로 로그인을 요청하면 서버는 정보를 확인후 세션 아이디를 서버에 저장하고 클라이언트에게도 보낸다.<br>\n이후 클라이언트는 요청시 세션아이디를 쿠키에 담아서 요청한다.<br>\n서버는 쿠키 속 세션아이디를 확인해 로그인된 사용자인지 확인하는 방식이다. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 700px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABh0lEQVQoz41R2Y7UMBCc//8nHsg+LMqMQGIEKIt2CRPvOPfts9027STLPiFhlZzuRFVd1Tm1o/mQPiefXz59K1+4Df84frv76zV/eGjOZ8c5tadZwPUn//L9Nbv11QD0Smu9LPM0jeu6OOestXT7jT49PeXJxzpNse0ieRe2NqALHgO4IKTr+rWsxr5f51k37TyMUhtvdAAfUGhTN7/yvGma0+bHS+EQfF3WfVVO+dfh+eKmktr6ztFCcOjBERAwSL0wliQJY+yYrCV6Y1Fr0jdDKevCy9kp5aTyRHAYvREAwjzDNNVtuy7LG9kEH2N59PQMO2LtEcyKIKg7VgeU8KgPslLBQei6sWD3229GYIzfCq7msfzx2GSPSEbIvgswS5QyRvX+jayD2b+56HEH4tHCVkSQ/VWZqh763gIcZEOZKRKJe9RirV5Zze+8KCwNIQ1SjXMh/hIlFedpmmZZ9r4wpNEQgcZoIYwQal39vqS/IBUpxTieL5d3stkW9l+H1AG6rpNS/gEAinkG40Pm7gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session flow\"\n        title=\"session flow\"\n        src=\"/static/19b6e2cf82dded8cbc4f58f65d4288ba/8c557/session-flow.png\"\n        srcset=\"/static/19b6e2cf82dded8cbc4f58f65d4288ba/5a46d/session-flow.png 300w,\n/static/19b6e2cf82dded8cbc4f58f65d4288ba/0a47e/session-flow.png 600w,\n/static/19b6e2cf82dded8cbc4f58f65d4288ba/8c557/session-flow.png 700w\"\n        sizes=\"(max-width: 700px) 100vw, 700px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>JWT 방식은 클라이언트가 서버에 로그인 요청을 보내면 정보를 확인 후 토큰으로 응답한다.\n이 때 토큰에는 사용자에 대한 정보가 일부 담겨있다.\n토큰은 서버에 저장하지 않는다.<br>\n이후 클라이언트는 요청시 헤더에 토큰을 함께 보낸다.\n비대칭키 암호화 방식을 사용하기 때문에 서버측에서는 이 토큰을 받아 시그니처를 복호화하여 디코딩하는 방식으로 토큰의 유효성을 검증한다.\n인증이 필요한 리소스에 접근할 시 복잡한 인증 과정 없이 토큰만으로 인증 및 인가를 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 470px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 104.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACr0lEQVQ4y61U227aQBDN/39HI/WhfagUJY3a5qVtkoe0RWBsbr7fwGB7sSGYAD6dWWJkB+hTRxq8rGePZ+acnQu8WlmW8mkZBpROG6rWg+N66Cgqer0e1K4Khbw/GGKkj+D57uFcWcO4qBa73U5uRtEEBoEyWJIKWJYNPwjguS7tmwiCEI5jI45nMp7PSdDXhC6qxf+wQ4b5YoFEZBBZjnSeYxanWK/XRxlUVRRFgSnFiGwBQfFxIghjuc+Qf56UIT7ePeH2UcNn8qufCibTpNHbCpwtmMxw86CSd3Fzr+DrbxMtzaDg3R7wl2bi3fUDPnx7wuXVD3z6riKiDCSIzKxsND+YxPhCIJfX93h/+4g7JUB76KLcbvaAlhtAGbn4o+no6i66IwerVYFoPEaXmB0NdWg9DbbtYLvZyPKUoY2BPabqBhTvwvaCY1Li2RRh4GO5yCFECs/zYJrWnmHTgK4T+46LNE1kjD4c0DunRsprDw+SmU5JJhbmWUaHUuR5juVyKZ3X7Bm9E0JgPp9LCXmeX+tvTYdsUwJst9sEJpAkCRwqsd8bYDDoI6Ty4zghj6XzB6MoItCgQV4DkANZEpWJLIUbehhHIUQujnS33W4xpg8dbkxZHgNySdUeH2A/Z6zVMAwbej0LyB0OxgF6fRUqMRzFERbP1MdlhmJdHAReZVhZA5B7wqTMZjO5th0LI5OGgTGUT8M2YNomXN+TH+90OtJfXl6woNvGzwZgBcT/N6S3U3e1uoLcCi5ZVVVJGk8nzrgBOJlM0Gq1DsCsu47ShaIo8H1f7nEMe8WwpmkSuCLzqIer1eqQEUvHMCzoNLaKYn2UMVfBwDg1D0+xXJ9z9f/VXpPlMzrk2/B2yryd6qcAzwq7Dngqq7cZ1oV9BMg9qYT8r0leB2ep1Pf+AosuSsSfAa+FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jwt flow\"\n        title=\"jwt flow\"\n        src=\"/static/14bd9a7ceb0dd3330a7f15d6f02a9d87/f96db/jwt-flow.png\"\n        srcset=\"/static/14bd9a7ceb0dd3330a7f15d6f02a9d87/5a46d/jwt-flow.png 300w,\n/static/14bd9a7ceb0dd3330a7f15d6f02a9d87/f96db/jwt-flow.png 470w\"\n        sizes=\"(max-width: 470px) 100vw, 470px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h3 id=\"특징\" style=\"position:relative;\"><a href=\"#%ED%8A%B9%EC%A7%95\" aria-label=\"특징 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>특징</h3>\n<ul>\n<li>최근 범용적으로 사용되고있고 웹, 모바일 호환성이 좋다.</li>\n<li>Payload가 많아져 토큰이 커지면 서버에 부담이 될수도 있다. </li>\n<li>토큰 재발급 전에 사용자 정보가 갱신되면 갱신된 정보가 적용되지 않는다.</li>\n<li>Stateless 환경에서 용이하다. </li>\n<li>만료시간전까지는 강제로 만료시킬 수 없어 노출되지 않도록 관리하는것이 중요하다.</li>\n</ul>\n<h3 id=\"탈취자에게도-허용한다\" style=\"position:relative;\"><a href=\"#%ED%83%88%EC%B7%A8%EC%9E%90%EC%97%90%EA%B2%8C%EB%8F%84-%ED%97%88%EC%9A%A9%ED%95%9C%EB%8B%A4\" aria-label=\"탈취자에게도 허용한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>탈취자에게도 허용한다.</h3>\n<p>JWT는 Stateless한 방식이다. 따라서 서버측에서는 토큰을 가진 사람이 정말 권한이 있는 당사자인지 확인할 수 없다는 특징이 있다.\n토큰 만으로 인증과 인가를 하기 때문에 액세스 토큰을 탈취하여 사용해도 그것을 구분할 수 없다는 의미이다. </p>\n<h3 id=\"refresh-token의-사용\" style=\"position:relative;\"><a href=\"#refresh-token%EC%9D%98-%EC%82%AC%EC%9A%A9\" aria-label=\"refresh token의 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Refresh Token의 사용</h3>\n<p>그래서 여러가지 보완을 하는 장치들이 생겨났다.\nRFC7519 에도 나와있지 않고 혹자는 권장사항이 아니라고도 하는 것을 읽었으나\n대표적으로 사용되는 방법으로는 Refresh Token 이 있다.  </p>\n<p>방법은 이러하다.\n리프레시 토큰은 사용자를 인증하는 것이 아니라 Access Token을 생성하는 용도로 쓰인다.\nAccess Token을 탈취당했더라도 유효기간을 짧게 설정하여 피해가 최소화 되도록 하기 위해 Access Token의 만료 시간을 짧게 설정한다.<br>\nRefresh Token의 유효기간은 길게 설정한다.\n사용자는 두 토큰을 서버에 전송해 인증하고, 만료시에는 Refresh Token으로 새로운 Access Token을 받아 저장한다.\nAccess Token이 탈취되어도 유효기간이 짧아 쓸 수 없도록 한 것이다.\n정상적인 사용자는 Refresh Token을 사용하여 새로운 Access Token을 생성하고 사용할 수 있다. </p>\n<h3 id=\"refresh-token이-탈취당하면\" style=\"position:relative;\"><a href=\"#refresh-token%EC%9D%B4-%ED%83%88%EC%B7%A8%EB%8B%B9%ED%95%98%EB%A9%B4\" aria-label=\"refresh token이 탈취당하면 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Refresh Token이 탈취당하면</h3>\n<p>이또한 구분할 수 없다.\n이를 보완하기 위해서는 서버에 저장공간을 사용하게 된다.\n이 부분에서는 여러가지 방법이 존재하는듯 하다.  </p>\n<p>Access Token과 Refresh Token 쌍을 저장하고 둘 다 확인하여 누군가가 쌍이 다른 Token을 보내오면 모든 토큰을 만료시키는 방법이다.\n토큰 위조를 어느정도 변별하고, 변조가 감지되었을 때 모두 만료시켜 새로운 로그인이 필요하도록 만드는 것이다.\n혹자는 Refresh Token을 일회성으로 만드는 방법도 고려한다고 하였다. </p>\n<h3 id=\"로그아웃\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%95%84%EC%9B%83\" aria-label=\"로그아웃 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로그아웃</h3>\n<p>클라이언트에서 저장된 토큰을 삭제하면 된다.\n혹시라도 로그아웃한 당시의 액세스토큰으로 접근했을 때 로그아웃 처리가 되도록 만료시키는 효과를 주고 싶다면<br>\n어떤식으로든 서버측의 저장소를 사용할 수 밖에 없다.\n서버측에 Access Token을 블랙리스트처럼 만료로 저장해두고 관리하던가,\n혹자는 로그아웃 토큰을 구현하기도 하는것 같다. </p>\n<p>그런데 서버의 저장소를 많이 사용한다면 토큰을 사용하는 의미가 퇴색되는것은 아닌가 하는 의문이 들기도 한다.</p>\n<h3 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현</h3>\n<p>스프링을 비롯한 각종 프레임워크에서 이미 JWT에 관한 구현체가 준비되어있기 때문에 가져다 쓰면 된다.\nSpring의 경우 Jwts, Claim이 지원된다.\n구현한 일부 코드는 이러하다. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">@Slf4j\n@RequiredArgsConstructor\n@Component\npublic class TokenProvider {\n\n    @Value(\"${secret.access}\")\n    private String secretKey;\n    @Value(\"${secret.refresh}\")\n    private String refreshKey;\n\n    private final long accessTokenValidTime = 60 * 1000L; // 1 hour\n    private final long refreshTokenValidTime =  7 * 24 * 60 * 60 * 1000L;   // 1 week\n\n    @PostConstruct\n    protected void init() {\n        secretKey = Base64.getEncoder().encodeToString(secretKey.getBytes());\n        refreshKey = Base64.getEncoder().encodeToString(refreshKey.getBytes());\n    }\n\n    public String createAccessToken(String memberId){\n\n        Claims claims = Jwts.claims();  // JWT payload 에 저장되는 정보단위\n        claims.put(\"memberId\", memberId);\n        Date now = new Date();\n\n        return Jwts.builder()\n                .setClaims(claims) \n                .setIssuedAt(now) \n                .setExpiration(new Date(now.getTime() + accessTokenValidTime)) \n                .signWith(SignatureAlgorithm.HS256, secretKey)\n                .compact();\n    }\n\n    public String createRefreshToken(String memberId){\n        Claims claims = Jwts.claims();\n        claims.put(\"memberId\", memberId);\n        Date now = new Date();\n\n        return Jwts.builder()\n                .setClaims(claims)\n                .setIssuedAt(now)\n                .setExpiration(new Date(now.getTime() + refreshTokenValidTime))\n                .signWith(SignatureAlgorithm.HS256, refreshKey)\n                .compact();\n    }\n\n    public String resolveAccessToken(HttpServletRequest request) {\n        log.info(\"AccessToken is \" + request.getHeader(\"accessToken\"));\n        return request.getHeader(\"accessToken\");\n    }\n\n    public String resolveRefreshToken(HttpServletRequest request) {\n        log.info(\"RefreshToken is \" + request.getHeader(\"refreshToken\"));\n        return request.getHeader(\"refreshToken\");\n    }\n\n    public Claims getClaimsAccessToken(String token) {\n        return Jwts.parserBuilder()\n                .setSigningKey(DatatypeConverter.parseBase64Binary(secretKey))\n                .build()\n                .parseClaimsJws(token)\n                .getBody();\n    }\n\n    public Claims getClaimsRefreshToken(String token) {\n        return Jwts.parserBuilder()\n                .setSigningKey(DatatypeConverter.parseBase64Binary(refreshKey))\n                .build()\n                .parseClaimsJws(token)\n                .getBody();\n    }\n    \n    ...... </code></pre></div>\n<h3 id=\"이해한-것\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%ED%95%B4%ED%95%9C-%EA%B2%83\" aria-label=\"이해한 것 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이해한 것</h3>\n<p>간단한 구현과 함께 공부를 하고나서 JWT에 대해 내가 이해한 핵심 내용은<br>\nJWT 토큰이 가지는 인증, 인가, 유효성 등을 적절하게 사용하는 것에 있다고 생각하였고\nJWT 토큰 사용시 발생하는 단점들에 대한 보완정책들\nToken 발급 시 DB를 조회하도록 할 것인가에 대한 부분이라던가, 여러가지 동시 로그인, 로그아웃에 대한 제어 등에 관한 문제는<br>\n서비스를 개발하는 사람이 선택하여 작성할 문제라고 파악하였다.</p>\n<p>+추가<br>\nJWT를 사용하는 것은 저장하지 않기 위함보다는, 세션 공유를 위해 클러스터링을 사용하는 등의 작업을 하지 않고서도\n스케일 업다운을 편리하게 할 수 있는 이점이 있는 부분이 크다고 한다.<br>\n실무에서는 꼭 로그인이 아니더라도 권한관리에도 사용한다고 하며,\n발급내역들은 저장해 유효성 검증을 보강하는 방향으로 활용한다고 한다. </p>\n<p>위와 같은 점을 반영해 프로젝트를 디벨롭해보기로 한다. </p>","frontmatter":{"title":"JWT 로그인을 구현하면서","date":"May 24, 2022"}}},"pageContext":{"slug":"/JWT/jwt/","previous":{"fields":{"slug":"/GIT/change_commit_author/"},"frontmatter":{"title":"이전 commit의 author 변경"}},"next":null}}}